<!DOCTYPE html>
<html>
    <head>
        <style>
            .table{
                width: 100%;
                line-height: 32px;
            }
            .bars { 
                float: left;
                height: 30px;
                width: 100px;
                line-height: 30px;
                border: 1px solid black;
                padding-left: 10px;
                padding-right: 10px;
                background: #FFFF99;
                text-align: center;
            }
            .bars0 { 
                float: left;
                height: 30px;
                width: 150px;
                line-height: 30px;
                border: 1px solid black;
                padding-left: 10px;
                padding-right: 10px;
                background: #FFFF44;
            }
            .row{
                width: 100%;
                clear: both;            
                color: #000000;
                clear: both; 
                font-weight: normal;
            }
            .rowhead{
                width: 100%;
                clear: both; 
                background: #FFFF44;
                color: #ff0000;
                font-weight: bold;
            }

            .fon { background:blue; }
            .foff { background:red; }
            .fauto { background:gray; }

        </style>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    </head>
    <body onload="getMyData()">
        <title>Ajax with eXML</title>
        <! ************************************************************** !>
        <h1>-HOME-</h1>
        <span id="state"> ..... </span>

        <h1>PROVA</h1>

        <button type="button" id="startData" style="height: 50px; width: 228px">Start getting data</button>&nbsp;&nbsp;
        <button type="button" id="stopData" style="height: 50px; width: 172px">Stop getting data</button><br>&nbsp;

        <h1>Programmi</h1>
        <div class="table">
            <div class="rowhead">
                <div class="bars0">Programma </div>
                <div class="bars">Stato</div></div>
            <div class="row">
                <div class="bars0">progBoilerACS </div>
                <div class="bars" id="progBoilerACS"> 0 </div>
                <div class="bars"> <a href='/set?progBoilerACS=0'> <input type='button' id='btn' value='FORCE OFF' class='foff'/> </a></div>
                <div class="bars"> <a href='/set?progBoilerACS=1'> <input type='button' id='btn' value='AUTO'      class='fauto'/></a></div>
                <div class="bars"> <a href='/set?progBoilerACS=2'> <input type='button' id='btn' value='FORCE ON'  class='fon'/></a></div></div>
            <div class="row">
                <div class="bars0">progSummerAC </div>
                <div class="bars" id="progSummerAC">0</div></div>
            <div class="row">
                <div class="bars0">progWinterFIRE </div>
                <div class="bars" id="progWinterFIRE">0</div></div>
            <div class="row">
                <div class="bars0">progWinterPDC     </div>
                <div class="bars" id="progWinterFIRE">0</div></div>
            <div class="row">
                <div class="bars0">progWinterPDC_ECO </div>
                <div class="bars" id="progWinterFIRE">0</div></div>
            <div class="row">
                <div class="bars0">progAllRooms </div>
                <div class="bars" id="progWinterFIRE">0</div></div>
            <div class="row">
                <div class="bars0">progExternalLight </div>
                <div class="bars" id="progWinterFIRE">0</div></div>
        </div>
        <br>
        <h1>Stanze</h1>
        <div class="table">
            <div class="rowhead">
                <div class="bars0">Stanza </div>
                <div class="bars">T</div></div>
            <div class="row">
                <div class="bars0">Cucina </div>
                <div class="bars" id="tCucina">0</div></div>
            <div class="row">
                <div class="bars0">Sala </div>
                <div class="bars" id="tSala">0</div></div>
            <div class="row">
                <div class="bars0">Bagno </div>
                <div class="bars" id="tBagno">0</div></div>
        </div>
        <script>		
            /*
            function GetAllData()
            {
                var request = new XMLHttpRequest();
                request.onreadystatechange = function()
                {
                   if (this.readyState == 4 && this.status == 200) {	

                    document.getElementById("state").innerHTML = "Connected";	

                    // get XML 
                    var xml = this.responseXML;

                    // get answers
                    var answers= xml.getElementsByTagName("Programmi")[0];
                    for (var i = 0; i < answers.childNodes.length; i++) 
                    {   
                    var name = answers.childNodes[i].nodeName;
                    document.getElementById("state").innerHTML = name;  
                    var element = xml.getElementsByTagName(name)[0];
                    var value = element.childNodes[0].nodeValue;
                    document.getElementById(name).innerHTML = value;
                    if ( value == 0)
                        document.getElementById(name).style.color = "blue";
                    else
                        document.getElementById(name).style.color = "red";                    
                    } 

                    // get answers
                    var answers= xml.getElementsByTagName("Stanze")[0];
                    for (var i = 0; i < answers.childNodes.length; i++) 
                    {   
                    var name = answers.childNodes[i].nodeName;
                    document.getElementById("state").innerHTML = name;  
                    var element = xml.getElementsByTagName(name)[0];
                    var value = element.childNodes[0].nodeValue;
                    document.getElementById(name).innerHTML = value;
                    if ( value == 0)
                        document.getElementById(name).style.color = "gray";
                    else 
                        document.getElementById(name).style.color = "blue";                   
                    }                   
                }			
                 }
                request.ontimeout = function()
                {		
                    document.getElementById("state").innerHTML = "NOT Connected";			
                }

                //request.open("GET", "ajax", true);   
                request.open("GET", "http://192.168.1.209/ajax", true);
                //request.send();
                setTimeout('GetAllData()', 5000);
            }

                function GetOnce()
            {
                var url = 'http://192.168.1.209/ajax';

                var request = new XMLHttpRequest();
                request.open("GET", url, false);
                request.send();
                var xml = request.responseXML;
                var users = xml.getElementsByTagName("user");
                for(var i = 0; i < users.length; i++) 
                {   
                    var user = users[i];
                    var names = user.getElementsByTagName("name");
                    for(var j = 0; j < names.length; j++) 
                    {
                        alert(names[j].childNodes[0].nodeValue);
                    }
                }
            }   
            */   
            var timeOut; //This variable is responsible for the frequency of data acquisition 

            //When the start button is clicked - get the data
            $("#startData").click(function(){
                $('#state').css({'background-color':'#FF1128'}); 
                getMyData(); //get data once the document is ready
            });  

            //Stop collecting data when the stop button is clicked.
            $("#stopData").click(function(){
                $('#state').css({'background-color':'#001128'}); 
                clearTimeout(timeOut);        //This clears any future requests for data (until the Start button is pressed again)
            });

            function getMyData()
            { 
//                //Construct the URL of the Arduino Server we plan to connect to
//                var myUrl = "http://192.168.1.209/json"
//                //var myUrl = "http://validate.jsontest.com/?json"
//
//                var myData = $.ajax({
//                    url: myUrl,              
//                    data: { tag: 'GetDataFromArduino'},
//                    dataType : "json",      //We will be requesting data in JSON format
//                    timeout : 20000,        //this will cancel the request if it has not received a reply within 10 seconds.
//                    success: function(data)
//                    {
//                        $("#state").html("<H2>Status: OK</H2>");  //clear any failure messages.
//
//                        $.each(data, function(index, element) 
//                               { 
//                            if(element.value<100){
//                                console.log('Low'); 
//                                $('#Analog' + element.key).css({'background-color':'#FF1128'}); 
//                            } else {
//                                $('#Analog' + element.key).css({'background-color':'#22FF22'});
//                            }
//
//                            $('#A'+element.key).html("<span>" + element.value + "</span>");
//                            $('#Analog' + element.key).animate({width: ((element.value/1023)*80)+"%"});
//                        });
//                    }});
//
//                var myUrl2 = "http://echo.jsontest.com/key/value/one/two"
//
//                var myData2 = $.ajax({
//                    url: myUrl2,              
//                    data: { tag: 'GetDataFromArduino'},
//                    dataType : "json",      //We will be requesting data in JSON format
//                    timeout : 20000,        //this will cancel the request if it has not received a reply within 10 seconds.
//                    success: function(data)
//                    {
//                        //$("#state").html("<H2>Status: JSONTEST</H2>");  //clear any failure messages.
//
//                        $.each(data, function(index, element) 
//                               { 
//                            if(element.value<100){
//                                console.log('Low'); 
//                                $('#Analog' + element.key).css({'background-color':'#FF1128'}); 
//                            } else {
//                                $('#Analog' + element.key).css({'background-color':'#22FF22'});
//                            }
//
//                            $('#A'+element.key).html("<span>" + element.value + "</span>");
//                            $('#Analog' + element.key).animate({width: ((element.value/1023)*80)+"%"});
//                        });
//                    }});

                // var myUrl2 = "http://echo.jsontest.com/key/value/one/two"
                 var myUrl2 = "http://192.168.1.209/xmltable"
                // 
                //                //start ajax request
                //                $.ajax({
                //                    url: myUrl2,
                //                    //force to handle it as text
                //                    dataType: "text",
                //                    success: function(data) {
                //
                //                        //data downloaded so we call parseJSON function 
                //                        //and pass downloaded data
                //                        var json = $.parseJSON(data);
                //                        //now json variable contains data in json format
                //                        //let's display a few items
                //                        for (var i=0;i<json.length;++i)
                //                        {
                //                            $('#results').append('<div class="name">'+json[i].name+'</>');
                //                        }
                //                    }
                //                });

                $.ajax({
                    type: "GET",
                    contentType: "application/xml",
                    url: myUrl2,
                    dataType: "xml",
                    success: function (data) {
                        alert(data);
                    },
                    error: function (result) {
                        alert("Error");
                    }
                });

                // timeOut = setTimeout('getMyData()', 2000); //this will request data again in 1 second.
            }

        </script>
    </body>
</html>
